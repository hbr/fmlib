<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>doc_reference_elements (fmlib_browser.doc_reference_elements)</title><meta charset="utf-8"/><link rel="stylesheet" href="../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="index.html">Up</a> â€“ <a href="../index.html">Index</a> &#x00BB; <a href="index.html">fmlib_browser</a> &#x00BB; doc_reference_elements</nav><header class="odoc-preamble"><h1 id="optimizing-big-applications-with-reference-elements"><a href="#optimizing-big-applications-with-reference-elements" class="anchor"></a>Optimizing Big Applications with Reference Elements</h1><p><a href="doc_detailed_overview.html" title="doc_detailed_overview">A More Detailed Overview</a> | <a href="doc.html" title="doc">Up</a></p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#potential-dom-diffing-bottlenecks">Potential Dom Diffing Bottlenecks</a></li><li><a href="#basics-of-reference-elements">Basics of Reference Elements</a></li><li><a href="#example-spreadsheet-application">Example Spreadsheet Application</a></li><li><a href="#reference-elements-and-mutable-state">Reference Elements and Mutable State</a></li></ul></nav></div><div class="odoc-content"><h2 id="potential-dom-diffing-bottlenecks"><a href="#potential-dom-diffing-bottlenecks" class="anchor"></a>Potential Dom Diffing Bottlenecks</h2><p>The library <a href="Fmlib_browser/index.html"><code>Fmlib_browser</code></a> does already a lot to reduce dom accesses by using a virtual dom and virtual dom diffing as described in the chapter <a href="doc_detailed_overview.html"><code>doc_detailed_overview</code></a>.</p><p>The limits of this approach is reached when the dom on a browser screen (including the clipped parts) becomes really huge.</p><p>Some examples where this might occur:</p><ul><li><p>A spreadsheet application with many thousand cells. Usually there is one cell in focus which can be edited. A change in one cell affects all other cells which use the edited cell in its formula either directly or indirectly. I.e. only a small subset of all cells is affected and need to be updated as a consequence of editing the cell in focus.</p><p>Diffing of the virtual doms before and after the modification detects all cells which need to be updated. But the diffing algorithm has to traverse the whole virtual dom to detect the changes. This might become a performance bottleneck for the animation frame.</p></li><li><p>A trading platform which displays a table with the state of several thousand assets of one or several stock exchanges. The table is sorted such that the most important (according to value or whatever criterion) assets come before the less important assets in the table.</p><p>Any state change is notified to the application and the application has to display the updated state and possibly the ordering of the assets.</p><p>As in the spreadsheed example virtual dom diffing might become a performance bottleneck.</p></li><li><p>An interactive code development environment has a source code editor and highlights errors with error descriptions displayed at the location of the error.</p><p>Firstly the source code editor has information which changes only in a very limited region of the source code.</p><p>Secondly an error shall be marked visually and displayed in detail when the user hovers with the mouse over the error.</p><p>Again a situation where virtual dom diffing is not very efficient.</p></li></ul><p>It is common to all these examples that the dom is really big, the application <em>knows</em> exactly what has changed and the virtual dom diffing can discover the changes only by traversing the whole dom. I.e. the application could easily trigger the change by issueing a command which makes the change of the display.</p><h2 id="basics-of-reference-elements"><a href="#basics-of-reference-elements" class="anchor"></a>Basics of Reference Elements</h2><p>The library <a href="Fmlib_browser/index.html"><code>Fmlib_browser</code></a> has reference elements to address the potential performance problem.</p><p>Each reference element has a unique name. They can be inserted into the virtual dom by <a href="Fmlib_browser/Html/index.html#val-reference"><code>Fmlib_browser.Html.reference</code></a>. Reference elements can contain arbitrarily big subdoms. For the virtual dom it is only important if the reference element is in the dom or not.</p><p>Reference elements can be used only in one location of the dom.</p><p>There is the command <a href="Fmlib_browser/Command/index.html#val-set_reference"><code>Fmlib_browser.Command.set_reference</code></a> to fill content into the reference element. The content of the reference element is described by another virtual dom which might point to other reference elements.</p><p>At the start the virtual dom of a reference element is empty. Each command</p><pre class="language-ocaml"><code>    Command.set_reference name vdom</code></pre><p>updates the content of the reference element by dom diffing of the subdom.</p><h2 id="example-spreadsheet-application"><a href="#example-spreadsheet-application" class="anchor"></a>Example Spreadsheet Application</h2><p>An example of a simple spreadsheet application can be found at <a href="https://github.com/hbr/fmlib/tree/master/src/examples/browser">https://github.com/hbr/fmlib/tree/master/src/examples/browser</a>.</p><p>Our simple spreadsheet example has one field which marks the current cell (e.g. <code>B2</code>) and editor field to edit the content of the current cell and a field which describes a potential error (e.g. cyclic reference or syntax error in the formula).</p><p>Below these field there is a big element with all the cells.</p><p>In the browser it looks like</p><pre>     +----------+     +----------+  +-----+
     | cell: B2 |     |= A1 + A2 |  | OK  |
     +----------+     +----------+  +-----+


     +----------------------------------------------------+
     |                                                    |
     |     A       B       C       D       E       ...    |
     |                                                    |
     | 1   2               100                            |
     |                                                    |
     | 2   5       7               2000                   |
     |                                                    |
     | 3                                                  |
     |                                                    |
     | 4                                                  |
     |                                                    |
     | ...                                                |
     |                                                    |
     +----------------------------------------------------+</pre><p>The view function of the application returns a virtual dom containing basically the 3 fields in the header and the whole content of the spreadsheet as one reference element e.g. named &quot;sheet&quot;.</p><p>I.e. virtual dom diffing in the animation frame is practically no effort.</p><p>The virtual dom of the content is the frame of the spreadsheet where the individual cells are again reference elements. I.e. the content is static and changes only of the size of the spreadheet changes.</p><p>Whenever the user modifies the content of a cell by modifying the editor field the application computes the updated value, recomputes the content of all cells which depend on the modified cell and issue a command to update the corresponding reference cells.</p><h2 id="reference-elements-and-mutable-state"><a href="#reference-elements-and-mutable-state" class="anchor"></a>Reference Elements and Mutable State</h2><p>The content of reference elements is not controlled by the application state. It is controlled by the command <code>set_reference</code>. Therefore all data in the application state describing the contents of reference elements can be mutable data in the state.</p><p>A change affecting only reference elements need not change the physical application state. If the physical application state is not change, no diffing of the virtual dom has to be done in the animation frame.</p><p><a href="doc_detailed_overview.html" title="doc_detailed_overview">A More Detailed Overview</a> | <a href="doc.html" title="doc">Up</a></p></div></body></html>
