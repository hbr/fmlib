<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Command (fmlib_browser.Fmlib_browser.Command)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">fmlib_browser</a> &#x00BB; <a href="../index.html">Fmlib_browser</a> &#x00BB; Command</nav><header class="odoc-preamble"><h1>Module <code><span>Fmlib_browser.Command</span></code></h1><p>Commands to be executed.</p><p>An elementary command consists of a <a href="../Task/index.html"><code>Task</code></a> to be executed.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#basics">Basics</a></li><li><a href="#simple-commands">Simple Commands</a><ul><li><a href="#time-and-time-zone">Time and Time Zone</a></li><li><a href="#focus-and-blur">Focus and Blur</a></li><li><a href="#file-operations">File Operations</a></li><li><a href="#logging-to-the-console">Logging to the Console</a></li><li><a href="#random-values">Random Values</a></li><li><a href="#send-messages">Send Messages</a></li><li><a href="#navigation">Navigation</a></li><li><a href="#reference-nodes">Reference Nodes</a></li><li><a href="#http-requests">Http Requests</a></li></ul></li><li><a href="#execute-tasks">Execute Tasks</a></li></ul></nav></div><div class="odoc-content"><h2 id="basics"><a href="#basics" class="anchor"></a>Basics</h2><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>_ t</span></span></code></div><div class="spec-doc"><p><code>msg t</code> is the type of a command generating an object of type <code>msg</code> to inject it into the update function of the application.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-none"><a href="#val-none" class="anchor"></a><code><span><span class="keyword">val</span> none : <span><span class="type-var">_</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>An empty command.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-batch"><a href="#val-batch" class="anchor"></a><code><span><span class="keyword">val</span> batch : <span><span><span><span class="type-var">'m</span> <a href="#type-t">t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>batch lst</code> A list of commands to be executed.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Map the message of a command.</p></div></div><h2 id="simple-commands"><a href="#simple-commands" class="anchor"></a>Simple Commands</h2><h3 id="time-and-time-zone"><a href="#time-and-time-zone" class="anchor"></a>Time and Time Zone</h3><div class="odoc-spec"><div class="spec value anchored" id="val-now"><a href="#val-now" class="anchor"></a><code><span><span class="keyword">val</span> now : <span><span>(<span><a href="../Time/index.html#type-t">Time.t</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'m</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Get the current time.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-time_zone"><a href="#val-time_zone" class="anchor"></a><code><span><span class="keyword">val</span> time_zone : <span><span>(<span><a href="../Time/Zone/index.html#type-t">Time.Zone.t</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'m</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Get the time zone.</p></div></div><h3 id="focus-and-blur"><a href="#focus-and-blur" class="anchor"></a>Focus and Blur</h3><div class="odoc-spec"><div class="spec value anchored" id="val-focus"><a href="#val-focus" class="anchor"></a><code><span><span class="keyword">val</span> focus : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>focus id</code></p><p>Focus the element <code>id</code>. If the element does not exist, then nothing is done. This command does not return any message.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-blur"><a href="#val-blur" class="anchor"></a><code><span><span class="keyword">val</span> blur : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>blur id</code></p><p>Blur the element <code>id</code>. If the element does not exist, then nothing is done. This command does not return any message.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-focus_with_info"><a href="#val-focus_with_info" class="anchor"></a><code><span><span class="keyword">val</span> focus_with_info : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>focus_with_info id ok not_found</code></p><p>Focus the element <code>id</code> and return <code>ok</code>. Return <code>not_found</code>, if the element does not exist.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-blur_with_info"><a href="#val-blur_with_info" class="anchor"></a><code><span><span class="keyword">val</span> blur_with_info : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>blur_with_info id ok not_found</code></p><p>Blur the element <code>id</code> and return <code>ok</code>. Return <code>not_found</code>, if the element does not exist.</p></div></div><h3 id="file-operations"><a href="#file-operations" class="anchor"></a>File Operations</h3><div class="odoc-spec"><div class="spec value anchored" id="val-select_file"><a href="#val-select_file" class="anchor"></a><code><span><span class="keyword">val</span> select_file : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><a href="../File/index.html#type-t">File.t</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'m</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>select_file media_types f</code> Show the browser's file selection dialog and produce <code>f file</code> when the user selected a file. The given list of <code>media_types</code> allows restricting what file types are visible in the dialog (users can still select different file types if they want to).</p><p>NOTE: This command only works if it is triggered in reaction to a user event, such as a mouse click. This restriction is imposed by browsers for security reasons (websites should not be able to ask for file access without user interaction).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-select_files"><a href="#val-select_files" class="anchor"></a><code><span><span class="keyword">val</span> select_files : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span><a href="../File/index.html#type-t">File.t</a> list</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'m</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>select_files media_types f</code> The same as <a href="#val-select_file"><code>select_file</code></a> but allows selecting multiple files at once.</p><p>NOTE: This command only works if it is triggered in reaction to a user event, such as a mouse click. This restriction is imposed by browsers for security reasons (websites should not be able to ask for file access without user interaction).</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-file_text"><a href="#val-file_text" class="anchor"></a><code><span><span class="keyword">val</span> file_text : 
  <span><a href="../File/index.html#type-t">File.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><span><span>(string, <a href="../Task/index.html#type-read_failed">Task.read_failed</a>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'m</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>file_text file f</code></p><p>Read the contents of <code>file</code> into a string <code>result</code> and produce the message <code>f result</code> when reading has finished. Reading can fail, e.g. in case of missing filesystem permissions.</p></div></div><h3 id="logging-to-the-console"><a href="#logging-to-the-console" class="anchor"></a>Logging to the Console</h3><div class="odoc-spec"><div class="spec value anchored" id="val-log_string"><a href="#val-log_string" class="anchor"></a><code><span><span class="keyword">val</span> log_string : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Print a string to the console, don't return a message.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-log_value"><a href="#val-log_value" class="anchor"></a><code><span><span class="keyword">val</span> log_value : <span><a href="../Value/index.html#type-t">Value.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Print a value to the console, don't return a message.</p></div></div><h3 id="random-values"><a href="#random-values" class="anchor"></a>Random Values</h3><div class="odoc-spec"><div class="spec value anchored" id="val-random"><a href="#val-random" class="anchor"></a><code><span><span class="keyword">val</span> random : <span><span><span class="type-var">'m</span> <a href="../Random/index.html#type-t">Random.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Generate a random value.</p></div></div><h3 id="send-messages"><a href="#send-messages" class="anchor"></a>Send Messages</h3><div class="odoc-spec"><div class="spec value anchored" id="val-notify"><a href="#val-notify" class="anchor"></a><code><span><span class="keyword">val</span> notify : <span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>notify millis msg</code></p><p>Send <code>msg</code> in <code>millis</code> milliseconds.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-send_to_javascript"><a href="#val-send_to_javascript" class="anchor"></a><code><span><span class="keyword">val</span> send_to_javascript : <span><a href="../Value/index.html#type-t">Value.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Send a value to the surrounding javascript code.</p></div></div><h3 id="navigation"><a href="#navigation" class="anchor"></a>Navigation</h3><div class="odoc-spec"><div class="spec value anchored" id="val-push_url"><a href="#val-push_url" class="anchor"></a><code><span><span class="keyword">val</span> push_url : <span><span><span class="type-var">'m</span> <a href="../Navigation/index.html#type-key">Navigation.key</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>push_url navigation_key url</code></p><p>Set the browser address bar to <code>url</code> and add an entry to the browser history. This requires a <code>navigation_key</code> which is only available in <a href="../index.html#val-application" title="application">full web applications</a>. See <a href="../Navigation/index.html#type-key"><code>Navigation.key</code></a> for details.</p><p>NOTE: For security reasons browsers don't allow setting an invalid URL or a URL with a different origin (protocol, hostname and port) than the current URL. Browsers may also enforce a rate limit for changing the URL. This means that if <code>url</code> is not a valid URL of the same origin or if we try to change the URL too frequently, an exception is thrown.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-replace_url"><a href="#val-replace_url" class="anchor"></a><code><span><span class="keyword">val</span> replace_url : <span><span><span class="type-var">'m</span> <a href="../Navigation/index.html#type-key">Navigation.key</a></span> <span class="arrow">&#45;&gt;</span></span> <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>replace_url navigation_key url</code></p><p>Like <code>push_url</code>, but do not add a new entry to the browser history.</p><p>This is useful for changing the <code>query</code> part of the URL according to user input, e.g. <code>?search=hats</code>. If <code>push_url</code> was used in this case, <a href="#val-back" title="Command.back">navigating back</a> would undo a single keystroke whereas users would rather expect to go to the previous page.</p><p>NOTE: For security reasons browsers don't allow setting an invalid URL or a URL with a different origin (protocol, hostname and port) than the current URL. Browsers may also enforce a rate limit for changing the URL. This means that if <code>url</code> is not a valid URL of the same origin or if we try to change the URL too frequently, an exception is thrown.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-back"><a href="#val-back" class="anchor"></a><code><span><span class="keyword">val</span> back : <span><span><span class="type-var">'m</span> <a href="../Navigation/index.html#type-key">Navigation.key</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>back navigation_key count</code></p><p>Navigate back <code>count</code> entries in the browser history. This requires a <code>navigation_key</code> which is only available in <a href="../index.html#val-application" title="application">full web applications</a>. See <a href="../Navigation/index.html#type-key"><code>Navigation.key</code></a> for details.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-forward"><a href="#val-forward" class="anchor"></a><code><span><span class="keyword">val</span> forward : <span><span><span class="type-var">'m</span> <a href="../Navigation/index.html#type-key">Navigation.key</a></span> <span class="arrow">&#45;&gt;</span></span> <span>int <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>forward navigation_key count</code></p><p>Navigate forward <code>count</code> entries in the browser history. This requires a <code>navigation_key</code> which is only available in <a href="../index.html#val-application" title="application">full web applications</a>. See <a href="../Navigation/index.html#type-key"><code>Navigation.key</code></a> for details.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-load"><a href="#val-load" class="anchor"></a><code><span><span class="keyword">val</span> load : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>load url</code></p><p>Load the given <code>url</code>. This causes a traditional page load. For navigating to a different page within a <a href="../index.html#val-application" title="application">single-page application</a>, use <a href="#val-push_url"><code>push_url</code></a> instead.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-reload"><a href="#val-reload" class="anchor"></a><code><span><span class="keyword">val</span> reload : <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>reload ()</code></p><p>Reload the current page.</p></div></div><h3 id="reference-nodes"><a href="#reference-nodes" class="anchor"></a>Reference Nodes</h3><p>More details on reference nodes see <a href="../Html/index.html#val-reference"><code>Html.reference</code></a>.</p><div class="odoc-spec"><div class="spec value anchored" id="val-set_reference"><a href="#val-set_reference" class="anchor"></a><code><span><span class="keyword">val</span> set_reference : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'m</span> <a href="../Html/index.html#type-t">Html.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>set_reference name vdom</code></p><p>Display <code>vdom</code> in the reference node <code>name</code>.</p><p>If a reference node <code>name</code> does not yet exist, then create a reference node.</p></div></div><h3 id="http-requests"><a href="#http-requests" class="anchor"></a>Http Requests</h3><div class="odoc-spec"><div class="spec value anchored" id="val-http_request"><a href="#val-http_request" class="anchor"></a><code><span><span class="keyword">val</span> http_request : 
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(string * string)</span> list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="../Http/Body/index.html#type-t">Http.Body.t</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'m</span> <a href="../Http/Expect/index.html#type-t">Http.Expect.t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span><a href="../Http/index.html#type-error">Http.error</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'m</span>)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>http_request method url headers body expect on_error</code></p><p>Make an http <code>method</code> request to <code>url</code> with <code>headers</code> and <code>body</code>. <code>expect</code> specifies the expected response format and can be used to produce a message. <code>on_error</code> transforms a <a href="../Http/index.html#type-error"><code>Http.error</code></a> into a message.</p><p>Examples:</p><pre class="language-ocaml"><code>    (* Send an empty body and expect a string response *)
    let on_success msg = Got_message msg in
    let on_error _ = Got_error &quot;Failed to obtain message&quot; in
    http_request
        &quot;GET&quot;
        &quot;/message/123&quot;
        []
        Http.Body.empty
        (Http.Expect.map on_success Http.Expect.string)
        on_error

    (* Send file contents as the body and expect a json object with
       field &quot;url&quot; *)
    let on_success url = Got_file_uploaded url in
    let on_error _ = Got_error &quot;file upload failed&quot; in
    http_request
        &quot;PUT&quot;
        &quot;/upload/my_file.txt&quot;
        []
        (Http.Body.file file)
        (Http.Expect.json Decoder.(map on_success (field &quot;url&quot; string)))
        on_error</code></pre></div></div><h2 id="execute-tasks"><a href="#execute-tasks" class="anchor"></a>Execute Tasks</h2><p>If a command wants to execute chains of simple commands before returning a message to the application, then it is necessary to create a task which does the more complex operation and perform the task within a command.</p><p>An object of type <code>('a, 'e) Task.t</code> is a task which in case of success returns a value of type <code>'a</code> and in case of failure returns a value of type <code>'e</code>.</p><p>An object of type <code>('a, Task.empty) Task.t</code> is a task which cannot fail.</p><div class="odoc-spec"><div class="spec value anchored" id="val-attempt"><a href="#val-attempt" class="anchor"></a><code><span><span class="keyword">val</span> attempt : <span><span>(<span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'e</span>)</span> <span class="xref-unresolved">Stdlib</span>.result</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'m</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'e</span>)</span> <a href="../Task/index.html#type-t">Task.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>attempt f task</code> Attempt the possibly failing <code>task</code> and map the result via the function <code>f</code> into a message to send to the application.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-perform"><a href="#val-perform" class="anchor"></a><code><span><span class="keyword">val</span> perform : <span><span><span>(<span class="type-var">'m</span>, <a href="../Task/index.html#type-empty">Task.empty</a>)</span> <a href="../Task/index.html#type-t">Task.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>perform task</code> Perform the non failing <code>task</code> and send the message generated by the task to the application.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-just_do"><a href="#val-just_do" class="anchor"></a><code><span><span class="keyword">val</span> just_do : <span><span><span>(unit, <a href="../Task/index.html#type-empty">Task.empty</a>)</span> <a href="../Task/index.html#type-t">Task.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'m</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>perform task</code> Perform the non failing <code>task</code> and don't send any message to the application.</p></div></div></div></body></html>
