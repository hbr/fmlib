<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Query (fmlib_browser.Fmlib_browser.Url.Parser.Query)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../../../../index.html">Index</a> &#x00BB; <a href="../../../../index.html">fmlib_browser</a> &#x00BB; <a href="../../../index.html">Fmlib_browser</a> &#x00BB; <a href="../../index.html">Url</a> &#x00BB; <a href="../index.html">Parser</a> &#x00BB; Query</nav><header class="odoc-preamble"><h1>Module <code><span>Parser.Query</span></code></h1><p>Parse query parameters</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#type">Type</a></li><li><a href="#elementary-query-parsers">Elementary Query Parsers</a></li><li><a href="#combining-query-parsers">Combining Query Parsers</a></li><li><a href="#mapping-query-parsers">Mapping Query Parsers</a></li></ul></nav></div><div class="odoc-content"><h2 id="type"><a href="#type" class="anchor"></a>Type</h2><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div><div class="spec-doc"><p>The query parser type.</p><p>An query parser of type <code>'a t</code> parses the query part of a url and returns an object of type <code>'a</code>.</p></div></div><h2 id="elementary-query-parsers"><a href="#elementary-query-parsers" class="anchor"></a>Elementary Query Parsers</h2><div class="odoc-spec"><div class="spec value anchored" id="val-string"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>string option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>string key</code> will parse the query parameter named <code>key</code> as string.</p><p>Both the key and value of the query parameter will be percent-decoded automatically.</p><p>For example. the parser <code>top &lt;/&gt; Query.string &quot;name&quot;</code> will behave like this:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host?name=Alice&quot;</code></p></td><td><p><code>Some (Some &quot;Alice&quot;)</code></p></td></tr><tr><td><p><code>&quot;http://host?name=Bob&quot;</code></p></td><td><p><code>Some (Some &quot;Bob&quot;)</code></p></td></tr><tr><td><p><code>&quot;http://host?name=%D0%91%D0%BE%D0%B1&quot;</code></p></td><td><p><code>Some (Some &quot;Боб&quot;)</code></p></td></tr><tr><td><p><code>&quot;http://host?name=&quot;</code></p></td><td><p><code>Some (Some &quot;&quot;)</code></p></td></tr><tr><td><p><code>&quot;http://host?name&quot;</code></p></td><td><p><code>Some None</code></p></td></tr><tr><td><p><code>&quot;http://host&quot;</code></p></td><td><p><code>Some None</code></p></td></tr></table></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-int"><a href="#val-int" class="anchor"></a><code><span><span class="keyword">val</span> int : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>int option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>int key</code> will parse the query parameter named <code>key</code> as integer.</p><p>The key of the query parameter will be percent-decoded automatically.</p><p>For example. the parser <code>top &lt;/&gt; Query.int &quot;year&quot;</code> will behave like this:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host?year=2025&quot;</code></p></td><td><p><code>Some (Some 2025)</code></p></td></tr><tr><td><p><code>&quot;http://host?year=Y2K&quot;</code></p></td><td><p><code>Some None</code></p></td></tr><tr><td><p><code>&quot;http://host?year=&quot;</code></p></td><td><p><code>Some None</code></p></td></tr><tr><td><p><code>&quot;http://host?year&quot;</code></p></td><td><p><code>Some None</code></p></td></tr><tr><td><p><code>&quot;http://host&quot;</code></p></td><td><p><code>Some None</code></p></td></tr></table></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-enum"><a href="#val-enum" class="anchor"></a><code><span><span class="keyword">val</span> enum : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span>(string * <span class="type-var">'a</span>)</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>enum key table</code> will parse the query parameter named <code>key</code> as string and will try to transform this string into a value by looking it up in the given <code>table</code>.</p><p>Example:</p><pre class="language-ocaml"><code>    let lang_parser:
        ([`Haskell | `OCaml | `Rust] option -&gt; 'a, 'a) Parser.t
        =
        let open Parser in
        top &lt;?&gt;
            Query.enum
                &quot;lang&quot;
                [(&quot;hs&quot;, `Haskell); (&quot;ml&quot;, `OCaml); (&quot;rs&quot;, `Rust)]</code></pre><p>The example parser produces the following results:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host?lang=ml&quot;</code></p></td><td><p><code>Some (Some `Ocaml)</code></p></td></tr><tr><td><p><code>&quot;http://host?lang=py&quot;</code></p></td><td><p><code>Some None</code></p></td></tr><tr><td><p><code>&quot;http://host?lang=&quot;</code></p></td><td><p><code>Some None</code></p></td></tr><tr><td><p><code>&quot;http://host?lang&quot;</code></p></td><td><p><code>Some None</code></p></td></tr><tr><td><p><code>&quot;http://host&quot;</code></p></td><td><p><code>Some None</code></p></td></tr></table></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-custom"><a href="#val-custom" class="anchor"></a><code><span><span class="keyword">val</span> custom : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>custom key f</code> will parse the query parameter named <code>key</code> by applying the function <code>f</code> to the list of raw (undecoded) string values referenced by <code>key</code> in the query string.</p><p>While the other query parsers, <a href="#val-string"><code>string</code></a>, <a href="#val-int"><code>int</code></a> and <a href="#val-enum"><code>enum</code></a>, only allow at most one occurrence of a key in the query string, <code>custom</code> allows handling multiple occurrences.</p><p>Example:</p><pre class="language-ocaml"><code>    let posts: int list option Parser.t =
        let open Parser in
        top &lt;?&gt; Query.custom &quot;post&quot; (List.filter_map int_of_string)</code></pre><p>The example parser produces the following results:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host?post=2&quot;</code></p></td><td><p><code>Some [2]</code></p></td></tr><tr><td><p><code>&quot;http://host?post=2&amp;post=7&quot;</code></p></td><td><p><code>Some [2; 7]</code></p></td></tr><tr><td><p><code>&quot;http://host?post=2&amp;post=x&quot;</code></p></td><td><p><code>Some [2]</code></p></td></tr><tr><td><p><code>&quot;http://host?hats=2&quot;</code></p></td><td><p><code>Some []</code></p></td></tr></table></div></div><h2 id="combining-query-parsers"><a href="#combining-query-parsers" class="anchor"></a>Combining Query Parsers</h2><div class="odoc-spec"><div class="spec value anchored" id="val-return"><a href="#val-return" class="anchor"></a><code><span><span class="keyword">val</span> return : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Make a query parser which parses nothing an returns a result.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&lt;*&gt;)"><a href="#val-(&lt;*&gt;)" class="anchor"></a><code><span><span class="keyword">val</span> (&lt;*&gt;) : <span><span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>This function can be used to transform more than one query parser into a compound query parser.</p><p>Example:</p><pre class="language-ocaml"><code>    type user = {fname: string option; lname: string option}

    let user_parser: (user -&gt; 'a, 'a) Parser.t =
        let open Parser in
        top &lt;?&gt;
        Query.(
            return (fun fname lname -&gt; {fname; lname})
            &lt;*&gt; string &quot;fname&quot;
            &lt;*&gt; string &quot;lname&quot;
        )</code></pre><p>The example parser produces the following results:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host?fname=Xavier&amp;lname=Leroy&quot;</code></p></td><td><p><code>Some ({fname = Some &quot;Xavier&quot;; lname = Some &quot;Leroy&quot;))</code></p></td></tr><tr><td><p><code>&quot;http://host?fname=Xavier&quot;</code></p></td><td><p><code>Some ({fname = Some &quot;Xavier&quot;; lname = None})</code></p></td></tr><tr><td><p><code>&quot;http://host?&quot;</code></p></td><td><p><code>Some ({fname = None; lname = None})</code></p></td></tr><tr><td><p><code>&quot;http://host&quot;</code></p></td><td><p><code>Some ({fname = None; lname = None})</code></p></td></tr></table></div></div><h2 id="mapping-query-parsers"><a href="#mapping-query-parsers" class="anchor"></a>Mapping Query Parsers</h2><div class="odoc-spec"><div class="spec value anchored" id="val-map"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>map f query_parser</code> transforms the <code>query_parser</code> which parses one query parameter via <code>f</code>.</p><p>Example:</p><pre class="language-ocaml"><code>    let search_term_parser: ([`Search of string] -&gt; 'a, 'a) Parser.t =
        let open Parser in
        top &lt;?&gt;
            Query.map
                (fun s -&gt; `Search (Option.value ~default:&quot;&quot; s))
                (Query.string &quot;search&quot;)</code></pre><p>The example parser produces the following results:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host?search=ocaml&quot;</code></p></td><td><p><code>Some (`Search &quot;ocaml&quot;)</code></p></td></tr><tr><td><p><code>&quot;http://host?search=&quot;</code></p></td><td><p><code>Some (`Search &quot;&quot;)</code></p></td></tr><tr><td><p><code>&quot;http://host?search&quot;</code></p></td><td><p><code>Some (`Search &quot;&quot;)</code></p></td></tr><tr><td><p><code>&quot;http://host&quot;</code></p></td><td><p><code>Some (`Search &quot;&quot;)</code></p></td></tr></table></div></div></div></body></html>
