<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Parser (fmlib_browser.Fmlib_browser.Url.Parser)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../../../index.html">Index</a> &#x00BB; <a href="../../../index.html">fmlib_browser</a> &#x00BB; <a href="../../index.html">Fmlib_browser</a> &#x00BB; <a href="../index.html">Url</a> &#x00BB; Parser</nav><header class="odoc-preamble"><h1>Module <code><span>Url.Parser</span></code></h1><p>Parse URLs.</p></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#basics">Basics</a></li><li><a href="#path">Path</a></li><li><a href="#query">Query</a></li><li><a href="#fragment">Fragment</a></li><li><a href="#run-parsers">Run parsers</a></li></ul></nav></div><div class="odoc-content"><h2 id="basics"><a href="#basics" class="anchor"></a>Basics</h2><div class="odoc-spec"><div class="spec type anchored" id="type-url"><a href="#type-url" class="anchor"></a><code><span><span class="keyword">type</span> url</span><span> = <a href="../index.html#type-t">t</a></span></code></div></div><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'b) t</span></span></code></div><div class="spec-doc"><p>The URL parser type</p></div></div><h2 id="path"><a href="#path" class="anchor"></a>Path</h2><div class="odoc-spec"><div class="spec value anchored" id="val-string"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>string</code> will parse a segment of the path as string.</p><p>The segment will be percent-decoded automatically.</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host/alice/&quot;</code></p></td><td><p><code>Some &quot;alice&quot;</code></p></td></tr><tr><td><p><code>&quot;http://host/bob&quot;</code></p></td><td><p><code>Some &quot;bob&quot;</code></p></td></tr><tr><td><p><code>&quot;http://host/%D0%91%D0%BE%D0%B1&quot;</code></p></td><td><p><code>Some &quot;Боб&quot;</code></p></td></tr><tr><td><p><code>&quot;http://host/42/&quot;</code></p></td><td><p><code>Some &quot;42&quot;</code></p></td></tr><tr><td><p><code>&quot;http://host/&quot;</code></p></td><td><p><code>None</code></p></td></tr></table></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-int"><a href="#val-int" class="anchor"></a><code><span><span class="keyword">val</span> int : <span><span>(<span>int <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>int</code> will parse a segment of the path as integer.</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host/alice/&quot;</code></p></td><td><p><code>None</code></p></td></tr><tr><td><p><code>&quot;http://host/bob&quot;</code></p></td><td><p><code>None</code></p></td></tr><tr><td><p><code>&quot;http://host/42/&quot;</code></p></td><td><p><code>Some &quot;42&quot;</code></p></td></tr><tr><td><p><code>&quot;http://host/&quot;</code></p></td><td><p><code>None</code></p></td></tr></table></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-s"><a href="#val-s" class="anchor"></a><code><span><span class="keyword">val</span> s : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>s str</code> will parse a segment of the path if it matches the given string <code>str</code>.</p><p>The segment will be percent-decoded automatically.</p><p>For example, the parser <code>s &quot;blog&quot; &lt;/&gt; int</code> will behave as follows:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host/blog/42&quot;</code></p></td><td><p><code>Some 42</code></p></td></tr><tr><td><p><code>&quot;http://host/tree/42&quot;</code></p></td><td><p><code>None</code></p></td></tr></table></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-custom"><a href="#val-custom" class="anchor"></a><code><span><span class="keyword">val</span> custom : <span><span>(<span>string <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>custom f</code> will parse a segment of the path by applying the function <code>f</code> to the raw segment.</p><p>Example:</p><pre class="language-ocaml"><code>    let positive_int: (int -&gt; 'a, 'a) Parser.t =
        Parser.custom @@
            fun s -&gt;
                match int_of_string_opt s with
                | Some i when i &gt; 0 -&gt;
                    Some i
                | _ -&gt;
                    None</code></pre><p>The example parser produces the following results:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host/0&quot;</code></p></td><td><p><code>None</code></p></td></tr><tr><td><p><code>&quot;http://host/-42&quot;</code></p></td><td><p><code>None</code></p></td></tr><tr><td><p><code>&quot;http://host/42&quot;</code></p></td><td><p><code>Some 42</code></p></td></tr></table></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&lt;/&gt;)"><a href="#val-(&lt;/&gt;)" class="anchor"></a><code><span><span class="keyword">val</span> (&lt;/&gt;) : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'b</span>, <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>p1 &lt;/&gt; p2</code> combines the segment parsers <code>p1</code> and <code>p2</code> and returns a new parser which will parse two path segments.</p><p>Example:</p><pre class="language-ocaml"><code>    let blog: (int -&gt; 'a, 'a) Parser.t =
        let open Parser in
        s &quot;blog&quot; &lt;/&gt; int</code></pre><p>The example parser will behave like this:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host/blog&quot;</code></p></td><td><p><code>None</code></p></td></tr><tr><td><p><code>&quot;http://host/blog/42&quot;</code></p></td><td><p><code>Some 42</code></p></td></tr><tr><td><p><code>&quot;http://host/blog/42/&quot;</code></p></td><td><p><code>Some 42</code></p></td></tr></table></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span>, <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>map f parser</code> transforms the <code>parser</code> via <code>f</code>.</p><p><code>f</code> can be a function taking as many values as the parser produces (see example 1) or, in case the parser produces no values at all, <code>f</code> can be a variant constructor or a variant tag (see example 2).</p><p>Examples 1:</p><pre class="language-ocaml"><code>    type date = {year: int; month: int; day: int}

    let date_parser: (date -&gt; 'a, 'a) Parser.t =
        let open Parser in
        map
            (fun year month day -&gt; {year; month; day})
            (int &lt;/&gt; int &lt;/&gt; int)</code></pre><p>The parser in example 1 will produce the following results:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host/2025/08/&quot;</code></p></td><td><p><code>None</code></p></td></tr><tr><td><p><code>&quot;http://host/2025/08/07&quot;</code></p></td><td><p><code>Some {year = 2025; month = 8; day = 7}</code></p></td></tr></table><p>Example 2:</p><pre class="language-ocaml"><code>    let language = Haskell | Ocaml | Rust

    let language_parser: (language -&gt; 'a, 'a) Parser.t =
        let open Parser in
        one_of
            [
                map Haskell (s &quot;hs&quot;);
                map OCaml (s &quot;ml&quot;);
                map Rust (s &quot;rs&quot;);
            ]</code></pre><p>The parser in example 2 will produce the following results:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host/hs&quot;</code></p></td><td><p><code>Some Haskell</code></p></td></tr><tr><td><p><code>&quot;http://host/ml&quot;</code></p></td><td><p><code>Some OCaml</code></p></td></tr><tr><td><p><code>&quot;http://host/rs&quot;</code></p></td><td><p><code>Some Rust</code></p></td></tr><tr><td><p><code>&quot;http://host/py&quot;</code></p></td><td><p><code>None</code></p></td></tr></table></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-one_of"><a href="#val-one_of" class="anchor"></a><code><span><span class="keyword">val</span> one_of : <span><span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>one_of parsers</code> runs the given <code>parsers</code> in the order they are provided. The result is the result of the first succeeding parser or <code>None</code> if all of them fail.</p><p>Example:</p><pre class="language-ocaml"><code>    type route =
        | Index
        | Article of int
        | Comment of {id: int; article_id: int}

    let route_parser: (route -&gt; 'a, 'a) Parser.t =
        let open Parser in
        one_of
            [
                map Index top;
                map (fun id -&gt; Article id) (s &quot;blog&quot; &lt;/&gt; int);
                map
                    (fun article_id id -&gt; Comment {id; article_id})
                    (s &quot;blog&quot; &lt;/&gt; int &lt;/&gt; s &quot;comment&quot; &lt;/&gt; int)
            ]</code></pre><p>The example parser will behave like this:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host/&quot;</code></p></td><td><p><code>Some Index</code></p></td></tr><tr><td><p><code>&quot;http://host/blog&quot;</code></p></td><td><p><code>None</code></p></td></tr><tr><td><p><code>&quot;http://host/blog/42&quot;</code></p></td><td><p><code>Some (Article 42)</code></p></td></tr><tr><td><p><code>&quot;http://host/blog/42&quot;</code></p></td><td><p><code>Some (Article 42)</code></p></td></tr><tr><td><p><code>&quot;http://host/blog/42/comment&quot;</code></p></td><td><p><code>None</code></p></td></tr><tr><td><p><code>&quot;http://host/blog/42/comment/5&quot;</code></p></td><td><p><code>Some (Comment {id = 5; article_id = 42}))</code></p></td></tr></table></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-top"><a href="#val-top" class="anchor"></a><code><span><span class="keyword">val</span> top : <span><span>(<span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>top</code> creates a parser that does not consume any path segment.</p><p>It can be used together with <a href="#val-one_of"><code>one_of</code></a> in order to use a common prefix for multiple parsers:</p><pre class="language-ocaml"><code>    type route = Overview | Post of int

    let blog: (route -&gt; 'a, 'a) Parser.t =
        let open Parser in
        s &quot;blog&quot; &lt;/&gt;
            one_of
                [
                    map Overview top;
                    map (fun id -&gt; Post id) (s &quot;post&quot; &lt;/&gt; int);
                ]</code></pre><p>The example parser produces the following results:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host/&quot;</code></p></td><td><p><code>None</code></p></td></tr><tr><td><p><code>&quot;http://host/blog&quot;</code></p></td><td><p><code>Some Overview</code></p></td></tr><tr><td><p><code>&quot;http://host/post/42&quot;</code></p></td><td><p><code>None</code></p></td></tr><tr><td><p><code>&quot;http://host/blog/post/42&quot;</code></p></td><td><p><code>Some (Post 42)</code></p></td></tr></table></div></div><h2 id="query"><a href="#query" class="anchor"></a>Query</h2><div class="odoc-spec"><div class="spec module anchored" id="module-Query"><a href="#module-Query" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Query/index.html">Query</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Parse query parameters</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&lt;?&gt;)"><a href="#val-(&lt;?&gt;)" class="anchor"></a><code><span><span class="keyword">val</span> (&lt;?&gt;) : <span><span><span>(<span class="type-var">'a</span>, <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> <a href="Query/index.html#type-t">Query.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>url_parser &lt;/?&gt; query_parser</code> combines a <code>url_parser</code> with a <code>query_parser</code>.</p><p>For example, the parser <code>s &quot;blog&quot; &lt;?&gt; Query.string &quot;search&quot;</code> produces the following results:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host/blog&quot;</code></p></td><td><p><code>Some None</code></p></td></tr><tr><td><p><code>&quot;http://host?search=ocaml&quot;</code></p></td><td><p><code>Some (Some &quot;ocaml&quot;)</code></p></td></tr><tr><td><p><code>&quot;http://host?search=&quot;</code></p></td><td><p><code>Some (Some &quot;&quot;)</code></p></td></tr><tr><td><p><code>&quot;http://host?search&quot;</code></p></td><td><p><code>Some (None)</code></p></td></tr></table></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-query"><a href="#val-query" class="anchor"></a><code><span><span class="keyword">val</span> query : <span><span><span class="type-var">'a</span> <a href="Query/index.html#type-t">Query.t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>query query_parser</code> converts <code>query_parser</code> to a URL parser.</p><p>This is useful if a URL has an empty path and we want to parse query parameters.</p><p>Example:</p><pre class="language-ocaml"><code>    (* The following parsers are equivalent *)

    let search_term_parser1: (string -&gt; 'a, 'a) Parser.t =
        let open Parser in
        query (Query.string &quot;search&quot;)

    let search_term_parser2: (string -&gt; 'a, 'a) Parser.t =
        let open Parser in
        top &lt;?&gt; Query.string &quot;search&quot;</code></pre><p>The example parsers behave as follows:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host&quot;</code></p></td><td><p><code>Some None</code></p></td></tr><tr><td><p><code>&quot;http://host?search=ocaml&quot;</code></p></td><td><p><code>Some (Some &quot;ocaml&quot;)</code></p></td></tr><tr><td><p><code>&quot;http://host?search=&quot;</code></p></td><td><p><code>Some (Some &quot;&quot;)</code></p></td></tr><tr><td><p><code>&quot;http://host?search&quot;</code></p></td><td><p><code>Some (None)</code></p></td></tr></table></div></div><h2 id="fragment"><a href="#fragment" class="anchor"></a>Fragment</h2><div class="odoc-spec"><div class="spec value anchored" id="val-fragment"><a href="#val-fragment" class="anchor"></a><code><span><span class="keyword">val</span> fragment : <span><span>(<span><span>string option</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>fragment f</code> creates a fragment parser that produces a value by calling <code>f</code> on the fragment part of the URL.</p><p>The fragment part is percent-decoded automatically.</p><p>For example. the parser <code>s &quot;excercises&quot; &lt;/&gt; fragment Fun.id</code> produces the folloing results:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;http://host/excercises&quot;</code></p></td><td><p><code>Some None</code></p></td></tr><tr><td><p><code>&quot;http://host/excercises#&quot;</code></p></td><td><p><code>Some (Some &quot;&quot;)</code></p></td></tr><tr><td><p><code>&quot;http://host/excercises#6&quot;</code></p></td><td><p><code>Some (Some &quot;6&quot;)</code></p></td></tr></table></div></div><h2 id="run-parsers"><a href="#run-parsers" class="anchor"></a>Run parsers</h2><div class="odoc-spec"><div class="spec value anchored" id="val-parse"><a href="#val-parse" class="anchor"></a><code><span><span class="keyword">val</span> parse : <span><span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>, <span class="type-var">'a</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-url">url</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span></span></code></div><div class="spec-doc"><p><code>parse parser url</code> runs the given <code>parser</code> on the given <code>url</code>.</p><p>Example:</p><pre class="language-ocaml"><code>    type route = Home | Blog of int | Not_found

    let route_parser: (route -&gt; 'a, 'a) Parser.t =
        let open Parser in
        one_of
            [
                map Home top;
                map (fun id -&gt; Blog id) (s &quot;blog&quot; &lt;/&gt; int);
            ]

    let route_of_string (str: string): route =
        match of_string str with
        | None -&gt;
            Not_found
        | Some url -&gt;
            Option.value ~default:Not_found (parse route_parser url)</code></pre><p>The <code>route_of_string</code> function above produces the following results:</p><table class="odoc-table"><tr><th><p>input</p></th><th><p>parse result</p></th></tr><tr><td><p><code>&quot;/blog/42&quot;</code></p></td><td><p><code>Not_found</code></p></td></tr><tr><td><p><code>&quot;https://example.com/&quot;</code></p></td><td><p><code>Home</code></p></td></tr><tr><td><p><code>&quot;https://example.com/blog&quot;</code></p></td><td><p><code>Not_found</code></p></td></tr><tr><td><p><code>&quot;https://example.com/blog/42&quot;</code></p></td><td><p><code>Blog 42</code></p></td></tr><tr><td><p><code>&quot;https://example.com/blog/42/&quot;</code></p></td><td><p><code>Blog 42</code></p></td></tr><tr><td><p><code>&quot;https://example.com/blog/42#introduction&quot;</code></p></td><td><p><code>Blog 42</code></p></td></tr><tr><td><p><code>&quot;https://example.com/blog/42?search=ocaml&quot;</code></p></td><td><p><code>Blog 42</code></p></td></tr><tr><td><p><code>&quot;https://example.com/settings&quot;</code></p></td><td><p><code>Not_found</code></p></td></tr></table></div></div></div></body></html>
