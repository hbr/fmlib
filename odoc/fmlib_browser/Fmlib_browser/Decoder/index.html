<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Decoder (fmlib_browser.Fmlib_browser.Decoder)</title><meta charset="utf-8"/><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta name="generator" content="odoc 3.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> – <a href="../../../index.html">Index</a> &#x00BB; <a href="../../index.html">fmlib_browser</a> &#x00BB; <a href="../index.html">Fmlib_browser</a> &#x00BB; Decoder</nav><header class="odoc-preamble"><h1>Module <code><span>Fmlib_browser.Decoder</span></code></h1></header><div class="odoc-tocs"><nav class="odoc-toc odoc-local-toc"><ul><li><a href="#overview">Overview</a></li><li><a href="#general">General</a></li><li><a href="#basic-decoders">Basic decoders</a></li><li><a href="#complex-decoders">Complex decoders</a></li></ul></nav></div><div class="odoc-content"><p>Decoder for Javascript Values</p><h2 id="overview"><a href="#overview" class="anchor"></a>Overview</h2><p>Suppose we have the following ocaml types</p><pre class="language-ocaml"><code>    type sex = Male | Female

    type tp = {
        name:   string;
        age:    int;
        sex:    sex
    }</code></pre><p>and we want to decode the javascript object</p><pre class="language-ocaml"><code>    {name: &quot;Jonathan&quot;, sex: &quot;male&quot;, age: 55}</code></pre><p>The we can use the following decoder</p><pre class="language-ocaml"><code>    let decode: tp Decode.t =
        let open Decode in
        let* name = field &quot;name&quot; string in
        let* age  = field &quot;age&quot;  int    in
        let* sex  =
            field
                &quot;sex&quot;
                (
                    let* str = string in
                    match str with
                    | &quot;male&quot; -&gt;
                        return Male
                    | &quot;female&quot; -&gt;
                        return Female
                    | _ -&gt;
                        fail
                )
        in
        return {name; age; sex}</code></pre><p>The decoder <code>decode</code> decodes any javascript object which has the fields <code>name</code> <code>age</code> and <code>sex</code> with a value of the appropriate type into the corresponding ocaml record.</p><h2 id="general"><a href="#general" class="anchor"></a>General</h2><p> </p><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a t</span></span></code></div><div class="spec-doc"><p><code>'a t</code> Type of a decoder which decodes a javascript value into an optional object of type <code>'a</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Value/index.html#type-t">Value.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> option</span></span></code></div><div class="spec-doc"><p><code>run decoder value</code> Run the decoder on a javascript value. If the decoder succeeds with value <code>a</code>, then return <code>Some a</code>. Otherwise return <code>None</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-return"><a href="#val-return" class="anchor"></a><code><span><span class="keyword">val</span> return : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>return a</code> Succeed with <code>a</code> regardless what the javascript object is.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fail"><a href="#val-fail" class="anchor"></a><code><span><span class="keyword">val</span> fail : <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Fail immediately.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&gt;&gt;=)"><a href="#val-(&gt;&gt;=)" class="anchor"></a><code><span><span class="keyword">val</span> (&gt;&gt;=) : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>dec &gt;&gt;= f</code></p><p>Equivalent to</p><pre class="language-ocaml"><code>    let* v = dec in
    f v</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(let*)"><a href="#val-(let*)" class="anchor"></a><code><span><span class="keyword">val</span> (let*) : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Combine decoders.</p><p>Example:</p><pre class="language-ocaml"><code>    let* a = dec1 in
    dec2 a</code></pre><p>First decode the javascript value with decoder <code>dec1</code>. In case of success with the value <code>a</code>, use decoder <code>dec2</code> which can depend on <code>a</code>.</p><p><code>let*</code> is useful to decode various fields of an object.</p><pre class="language-ocaml"><code>    let* f1 = field &quot;name1&quot; dec1 in
    let* f2 = field &quot;name2&quot; dec2 in
    ...
    return ...</code></pre></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-map"><a href="#val-map" class="anchor"></a><code><span><span class="keyword">val</span> map : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>map f dec</code> Decode using <code>dec</code> and in case of success, map the decoded value <code>a</code> to <code>f a</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&lt;/&gt;)"><a href="#val-(&lt;/&gt;)" class="anchor"></a><code><span><span class="keyword">val</span> (&lt;/&gt;) : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>dec1 &lt;/&gt; dec2</code> First try decoder <code>dec1</code>. If it succeeds, return the decoded value. In case <code>dec1</code> fails, use <code>dec2</code> to decode the javascript value.</p></div></div><h2 id="basic-decoders"><a href="#basic-decoders" class="anchor"></a>Basic decoders</h2><p> </p><div class="odoc-spec"><div class="spec value anchored" id="val-null"><a href="#val-null" class="anchor"></a><code><span><span class="keyword">val</span> null : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>null v</code> If the javascript value is <code>null</code>, then return <code>v</code>. Otherwise fail.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-undefined"><a href="#val-undefined" class="anchor"></a><code><span><span class="keyword">val</span> undefined : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>undefined v</code> If the javascript value is <code>undefined</code>, then return <code>v</code>. Otherwise fail.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-int"><a href="#val-int" class="anchor"></a><code><span><span class="keyword">val</span> int : <span>int <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Decode an integer value i.e. a number between <code>-2^31</code> and <code>2^31 - 1</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bool"><a href="#val-bool" class="anchor"></a><code><span><span class="keyword">val</span> bool : <span>bool <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Decode a boolean value.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-float"><a href="#val-float" class="anchor"></a><code><span><span class="keyword">val</span> float : <span>float <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Decode a floating point value i.e. a number.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-string"><a href="#val-string" class="anchor"></a><code><span><span class="keyword">val</span> string : <span>string <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Decode a string value. The decoding converts the javascript string from utf16 into an ocaml utf8 string.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-file_list"><a href="#val-file_list" class="anchor"></a><code><span><span class="keyword">val</span> file_list : <span><span><a href="../File/index.html#type-t">File.t</a> list</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Decode a javascript <code>FileList</code> object into an ocaml list of <code>file</code>.</p></div></div><h2 id="complex-decoders"><a href="#complex-decoders" class="anchor"></a>Complex decoders</h2><p> </p><div class="odoc-spec"><div class="spec value anchored" id="val-field"><a href="#val-field" class="anchor"></a><code><span><span class="keyword">val</span> field : <span>string <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>field name dec</code> Decode the field named <code>name</code> in the javascript object with the decoder <code>dec</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-array"><a href="#val-array" class="anchor"></a><code><span><span class="keyword">val</span> array : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> array</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>array dec</code> Decode a javascript array into an ocaml array using <code>dec</code> to decode elements.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-option"><a href="#val-option" class="anchor"></a><code><span><span class="keyword">val</span> option : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> option</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>option dec</code> In case the javascript object is <code>null</code> succeed with <code>None</code>. Otherwise use <code>dec</code> to decode the object and in case of success wrap the result with <code>Some</code>.</p><p>Examples:</p><pre class="language-ocaml"><code>    run (option int) Value.null         ~&gt;      Some None
    run (option int) (Value.int 5)      ~&gt;      Some (Some 5)
    run (option int) (Value.string &quot;a&quot;) ~&gt;      None</code></pre></div></div></div></body></html>
